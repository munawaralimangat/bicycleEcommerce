<%-include('../includes/userStart') %>

    <body class="dark:bg-gray-800 bg-gray-100">
        <header>
            <%-include('../includes/userHomeNav') %>
        </header>
        <% if(product){ %>

            <section class="mt-24 ">
                <div class="bg-gray-100 dark:bg-gray-800 py-8">
                    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
                        <div class="flex flex-col md:flex-row -mx-4">
                            <div class="md:flex-1 px-4">
                                <div class="h-[460px] rounded-lg bg-gray-300 dark:bg-gray-700 mb-4" id="zoom-container">
                                    <img class="w-full h-full object-cover cursor-pointer"
                                        src="/uploads/<%=product.front_image.filename %>" alt="Product Image"
                                        id="zoom-image">
                                </div>
                                <ol class="flex -mx-2 mb-4">
                                    <li class="w-1/2 h-1/2 px-2">
                                        <img class="w-full h-full object-cover cursor-pointer"
                                            src="/uploads/<%=product.front_image.filename %>" alt="Product Image"
                                            onclick="changeZoomImage(this)">
                                    </li>
                                    <li class="w-1/2 h-1/2 px-2">
                                        <img class="w-full h-full object-cover cursor-pointer"
                                            src="/uploads/<%=product.product_images[0].filename %>" alt="Product Image"
                                            onclick="changeZoomImage(this)">
                                    </li>
                                    <li class="w-1/2 h-1/2 px-2">
                                        <img class="w-full h-full object-cover cursor-pointer"
                                            src="/uploads/<%=product.product_images[1].filename %>" alt="Product Image"
                                            onclick="changeZoomImage(this)">
                                    </li>
                                    <li class="w-1/2 h-1/2 px-2">
                                        <img class="w-full h-full object-cover cursor-pointer"
                                            src="/uploads/<%=product.product_images[2].filename %>" alt="Product Image"
                                            onclick="changeZoomImage(this)">
                                    </li>

                                </ol>

                            </div>
                            <div class="md:flex-1 px-4">
                                <h2 class="text-2xl font-bold text-gray-800 dark:text-white mb-1">
                                    <%=product.product_name %>
                                </h2>
                                <h4 class="text-1xl font-semibold text-gray-400 dark:text-white mb-2">
                                    <%=product.category_name.category_name %>
                                </h4>
                                <p class="text-gray-600 dark:text-gray-300 text-sm mb-4">
                                    Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed sed
                                    ante justo. Integer euismod libero id mauris malesuada tincidunt.
                                </p>
                                <div class="flex mb-4">
                                    <div class="mr-4">
                                        <span class="font-bold text-gray-700 dark:text-gray-300">Price:</span>
                                        <span class="text-gray-600 dark:text-gray-300">$<%=product.product_price %>
                                        </span>
                                    </div>
                                    <div>
                                        <span class="font-bold text-gray-700 dark:text-gray-300">Availability:
                                            <%=product.variations[0].size.size_name %>
                                        </span>
                                        <span class="text-gray-600 dark:text-gray-300">In Stock</span>
                                    </div>
                                </div>
                                <!-- <div class="mb-4">
                    <span class="font-bold text-gray-700 dark:text-gray-300">Select Color:</span>
                    <div class="flex items-center mt-2">
                        <button class="w-6 h-6 rounded-full bg-gray-800 dark:bg-gray-900 mr-2" onclick="selectColor('black','product._id%>')"></button>
                        <button class="w-6 h-6 rounded-full bg-red-500 dark:bg-red-700 mr-2" onclick="selectColor('red','product._id%>')"></button>
                        <button class="w-6 h-6 rounded-full bg-white dark:bg-white mr-2" onclick="selectColor('white','product._id%>')"></button>
                    </div>
                </div> -->
                                <div class="mb-4">
                                    <span class="font-bold text-gray-700 dark:text-gray-300">Select Size:</span>
                                    <div class="flex items-center mt-2">
                                        <button
                                            class="bg-gray-300 dark:bg-gray-700 text-gray-700 dark:text-white py-2 px-4 rounded-full font-bold mr-2 hover:bg-gray-400 dark:hover:bg-gray-600 focus:bg-gray-500"
                                            onclick="selectSize('Small','<%=product._id%>')">S</button>
                                        <button
                                            class="bg-gray-300 dark:bg-gray-700 text-gray-700 dark:text-white py-2 px-4 rounded-full font-bold mr-2 hover:bg-gray-400 dark:hover:bg-gray-600 focus:bg-gray-500"
                                            onclick="selectSize('Medium','<%=product._id%>')">M</button>
                                        <button
                                            class="bg-gray-300 dark:bg-gray-700 text-gray-700 dark:text-white py-2 px-4 rounded-full font-bold mr-2 hover:bg-gray-400 dark:hover:bg-gray-600 focus:bg-gray-500"
                                            onclick="selectSize('Large','<%=product._id%>')">L</button>
                                    </div>
                                </div>
                                <div>
                                    <span class="font-bold text-gray-700 dark:text-gray-300">Product Description:</span>
                                    <p class="text-gray-600 dark:text-gray-300 text-sm mt-2">
                                        Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed
                                        sed ante justo. Integer euismod libero id mauris malesuada tincidunt. Vivamus
                                        commodo nulla ut
                                        lorem rhoncus aliquet. Duis dapibus augue vel ipsum pretium, et venenatis sem
                                        blandit. Quisque
                                        ut erat vitae nisi ultrices placerat non eget velit. Integer ornare mi sed ipsum
                                        lacinia, non
                                        sagittis mauris blandit. Morbi fermentum libero vel nisl suscipit, nec tincidunt
                                        mi consectetur.
                                    </p>
                                </div>
                                <div class="flex mx-2 mb-4 mt-10">
                                    <div class="w-1/2 px-2">
                                        <button <% if(user){ %>
                                            onclick="addToCart('<%=product._id%>','<%=user._id%>')"
                                                    <% } %>
                                                        class="w-full bg-gray-900 dark:bg-gray-600 text-white py-2 px-4
                                                        rounded-full font-bold hover:bg-gray-800
                                                        dark:hover:bg-gray-700">Add to Cart</button>
                                    </div>
                                    <div class="w-1/2 px-2">
                                        <button <% if(user){ %>
                                            onclick="addToWishlist('<%=product._id%>','<%=user._id%>')"
                                                    <% } %>
                                                        class="w-full bg-gray-200 dark:bg-gray-700 text-gray-800
                                                        dark:text-white py-2 px-4 rounded-full font-bold
                                                        hover:bg-gray-300 dark:hover:bg-gray-600">Add to
                                                        Wishlist</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            <% } %>



                <!-- <%-include('../includes/components/userFooter')  %> -->
                <%-include('../includes/userEnd') %><!--add to cart added-->

                    <script>
                        async function selectSize(size, productId) {
                            try {
                                let res = await fetch(`/brepublic/product/${productId}?size=${size}`);
                                console.log("response1", res);
                                if (!res.ok) {
                                    // Handle non-successful response (e.g., 404 Not Found, 500 Internal Server Error)
                                    console.error(`Error: ${res.status} - ${res.statusText}`);
                                    const responseBody = await res.text();
                                    console.log("Response Body:", responseBody);
                                    return;
                                }

                                let data = await res.json();
                                console.log("Response Body:", data.otherProduct);

                                // Check if otherProduct is available and has an ID
                                if (data.otherProduct && data.otherProduct._id) {
                                    const otherProductId = data.otherProduct._id;
                                    location.assign(`/brepublic/product/${otherProductId}`);
                                } else {
                                    // Handle the case where otherProduct or its ID is not available
                                    console.log('Other product or its ID not available');
                                }
                            } catch (error) {
                                console.log(error);
                            }
                        }
                    </script>


                    <script>
                        function changeZoomImage(clickedImage) {
                            let newImageSrc = clickedImage.src;

                            document.getElementById('zoom-image').src = newImageSrc;
                        }
                    </script>

                    <!-- <script>
                        // image zooming
                        const zoomContainer = document.getElementById('zoom-container');
                        const zoomImage = document.getElementById('zoom-image');

                        // Add a mousemove event listener to the image container
                        zoomContainer.addEventListener('mousemove', handleMouseMove);

                        // Function to handle mousemove events
                        function handleMouseMove(event) {
                            // Get the position of the mouse within the image container
                            const x = event.pageX - zoomContainer.offsetLeft;
                            const y = event.pageY - zoomContainer.offsetTop;

                            // Calculate the percentage position within the image
                            let percentX = (x / zoomContainer.offsetWidth) * 75;
                            let percentY = (y / zoomContainer.offsetHeight) * 75;

                            // Calculate the maximum percentage position to ensure the zoomed image stays within the container
                            const maxPercentX = Math.max(0, 75 - (zoomImage.width / zoomContainer.offsetWidth) * 75);
                            const maxPercentY = Math.max(0, 75 - (zoomImage.height / zoomContainer.offsetHeight) * 75);

                            // Ensure that the percentage position does not exceed the maximum values
                            percentX = Math.min(percentX, maxPercentX);
                            percentY = Math.min(percentY, maxPercentY);

                            // Apply the zoom effect using CSS transform
                            zoomImage.style.transformOrigin = `${percentX}% ${percentY}%`;
                            zoomImage.style.transform = 'scale(1.20)'; // You can adjust the scale factor as needed
                        }

                        // Add a mouseleave event listener to reset the zoom on mouse out
                        zoomContainer.addEventListener('mouseleave', () => {
                            zoomImage.style.transform = 'scale(1)';
                        });
                    </script> -->